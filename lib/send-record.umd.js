(function(R,l){typeof exports=="object"&&typeof module<"u"?l(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],l):(R=typeof globalThis<"u"?globalThis:R||self,l(R.SendRecord={},R.Vue))})(this,function(R,l){"use strict";var B=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function C(v){return v&&v.__esModule&&Object.prototype.hasOwnProperty.call(v,"default")?v.default:v}var A={exports:{}};/*!
 * 
 * js-audio-recorder - js audio recorder plugin
 * 
 * @version v1.0.7
 * @homepage https://github.com/2fps/recorder
 * @author 2fps <echoweb@126.com> (https://www.zhuyuntao.cn)
 * @license MIT
 *         
 */(function(v,m){(function(_,u){v.exports=u()})(B,function(){return function(_){var u={};function f(a){if(u[a])return u[a].exports;var i=u[a]={i:a,l:!1,exports:{}};return _[a].call(i.exports,i,i.exports,f),i.l=!0,i.exports}return f.m=_,f.c=u,f.d=function(a,i,o){f.o(a,i)||Object.defineProperty(a,i,{enumerable:!0,get:o})},f.r=function(a){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})},f.t=function(a,i){if(1&i&&(a=f(a)),8&i||4&i&&typeof a=="object"&&a&&a.__esModule)return a;var o=Object.create(null);if(f.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:a}),2&i&&typeof a!="string")for(var t in a)f.d(o,t,(function(n){return a[n]}).bind(null,t));return o},f.n=function(a){var i=a&&a.__esModule?function(){return a.default}:function(){return a};return f.d(i,"a",i),i},f.o=function(a,i){return Object.prototype.hasOwnProperty.call(a,i)},f.p="",f(f.s=1)}([function(_,u,f){function a(i,o,t){for(var n=0;n<t.length;n++)i.setUint8(o+n,t.charCodeAt(n))}Object.defineProperty(u,"__esModule",{value:!0}),u.compress=function(i,o,t){for(var n=o/t,h=Math.max(n,1),c=i.left,r=i.right,e=Math.floor((c.length+r.length)/n),p=new Float32Array(e),s=0,w=0;s<e;){var d=Math.floor(w);p[s]=c[d],s++,r.length&&(p[s]=r[d],s++),w+=h}return p},u.encodePCM=function(i,o,t){t===void 0&&(t=!0);var n=0,h=i.length*(o/8),c=new ArrayBuffer(h),r=new DataView(c);if(o===8)for(var e=0;e<i.length;e++,n++){var p=(s=Math.max(-1,Math.min(1,i[e])))<0?128*s:127*s;p=+p+128,r.setInt8(n,p)}else for(e=0;e<i.length;e++,n+=2){var s=Math.max(-1,Math.min(1,i[e]));r.setInt16(n,s<0?32768*s:32767*s,t)}return r},u.encodeWAV=function(i,o,t,n,h,c){c===void 0&&(c=!0);var r=t>o?o:t,e=h,p=new ArrayBuffer(44+i.byteLength),s=new DataView(p),w=n,d=0;a(s,d,"RIFF"),d+=4,s.setUint32(d,36+i.byteLength,c),a(s,d+=4,"WAVE"),a(s,d+=4,"fmt "),d+=4,s.setUint32(d,16,c),d+=4,s.setUint16(d,1,c),d+=2,s.setUint16(d,w,c),d+=2,s.setUint32(d,r,c),d+=4,s.setUint32(d,w*r*(e/8),c),d+=4,s.setUint16(d,w*(e/8),c),d+=2,s.setUint16(d,e,c),a(s,d+=2,"data"),d+=4,s.setUint32(d,i.byteLength,c),d+=4;for(var g=0;g<i.byteLength;)s.setUint8(d,i.getUint8(g)),d++,g++;return s}},function(_,u,f){var a,i=this&&this.__extends||(a=function(c,r){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,p){e.__proto__=p}||function(e,p){for(var s in p)p.hasOwnProperty(s)&&(e[s]=p[s])})(c,r)},function(c,r){function e(){this.constructor=c}a(c,r),c.prototype=r===null?Object.create(r):(e.prototype=r.prototype,new e)});Object.defineProperty(u,"__esModule",{value:!0});var o=f(2),t=f(0),n=f(3),h=function(c){function r(e){e===void 0&&(e={});var p=c.call(this,e)||this;return p.isrecording=!1,p.ispause=!1,p.isplaying=!1,p}return i(r,c),r.prototype.setOption=function(e){e===void 0&&(e={}),this.setNewOption(e)},r.prototype.start=function(){return this.isrecording?Promise.reject():(this.isrecording=!0,this.startRecord())},r.prototype.pause=function(){this.isrecording&&!this.ispause&&(this.ispause=!0,this.pauseRecord())},r.prototype.resume=function(){this.isrecording&&this.ispause&&(this.ispause=!1,this.resumeRecord())},r.prototype.stop=function(){this.isrecording&&(this.isrecording=!1,this.ispause=!1,this.stopRecord())},r.prototype.play=function(){this.stop(),this.isplaying=!0,this.onplay&&this.onplay(),n.default.addPlayEnd(this.onplayend);var e=this.getWAV();e.byteLength>44&&n.default.play(e.buffer)},r.prototype.getPlayTime=function(){return n.default.getPlayTime()},r.prototype.pausePlay=function(){!this.isrecording&&this.isplaying&&(this.isplaying=!1,this.onpauseplay&&this.onpauseplay(),n.default.pausePlay())},r.prototype.resumePlay=function(){this.isrecording||this.isplaying||(this.isplaying=!0,this.onresumeplay&&this.onresumeplay(),n.default.resumePlay())},r.prototype.stopPlay=function(){this.isrecording||(this.isplaying=!1,this.onstopplay&&this.onstopplay(),n.default.stopPlay())},r.prototype.destroy=function(){return n.default.destroyPlay(),this.destroyRecord()},r.prototype.getRecordAnalyseData=function(){return this.getAnalyseData()},r.prototype.getPlayAnalyseData=function(){return n.default.getAnalyseData()},r.prototype.getPCM=function(){this.stop();var e=this.getData();return e=t.compress(e,this.inputSampleRate,this.outputSampleRate),t.encodePCM(e,this.oututSampleBits,this.littleEdian)},r.prototype.getPCMBlob=function(){return new Blob([this.getPCM()])},r.prototype.downloadPCM=function(e){e===void 0&&(e="recorder");var p=this.getPCMBlob();o.downloadPCM(p,e)},r.prototype.getWAV=function(){var e=this.getPCM();return t.encodeWAV(e,this.inputSampleRate,this.outputSampleRate,this.config.numChannels,this.oututSampleBits,this.littleEdian)},r.prototype.getWAVBlob=function(){return new Blob([this.getWAV()],{type:"audio/wav"})},r.prototype.downloadWAV=function(e){e===void 0&&(e="recorder");var p=this.getWAVBlob();o.downloadWAV(p,e)},r.prototype.download=function(e,p,s){o.download(e,p,s)},r.prototype.getChannelData=function(){var e=this.getPCM(),p=e.byteLength,s=this.littleEdian,w={left:null,right:null};if(this.config.numChannels===2){var d=new DataView(new ArrayBuffer(p/2)),g=new DataView(new ArrayBuffer(p/2));if(this.config.sampleBits===16)for(var y=0;y<p/2;y+=2)d.setInt16(y,e.getInt16(2*y,s),s),g.setInt16(y,e.getInt16(2*y+2,s),s);else for(y=0;y<p/2;y+=2)d.setInt8(y,e.getInt8(2*y)),g.setInt8(y,e.getInt8(2*y+1));w.left=d,w.right=g}else w.left=e;return w},r}(f(5).default);u.default=h},function(_,u,f){function a(i,o,t){var n=document.createElement("a");n.href=window.URL.createObjectURL(i),n.download=o+"."+t,n.click()}Object.defineProperty(u,"__esModule",{value:!0}),u.downloadWAV=function(i,o){o===void 0&&(o="recorder"),a(i,o,"wav")},u.downloadPCM=function(i,o){o===void 0&&(o="recorder"),a(i,o,"pcm")},u.download=function(i,o,t){return a(i,o,t)}},function(_,u,f){Object.defineProperty(u,"__esModule",{value:!0});var a=f(4),i=null,o=0,t=0,n=null,h=null,c=null,r=!1,e=0,p=function(){};function s(){return r=!1,n.decodeAudioData(c.slice(0),function(g){(i=n.createBufferSource()).onended=function(){r||(e=n.currentTime-t+o,p())},i.buffer=g,i.connect(h),h.connect(n.destination),i.start(0,o),t=n.currentTime},function(g){a.throwError(g)})}function w(){i&&(i.stop(),i=null)}var d=function(){function g(){}return g.play=function(y){return n||(n=new(window.AudioContext||window.webkitAudioContext),(h=n.createAnalyser()).fftSize=2048),this.stopPlay(),c=y,e=0,s()},g.pausePlay=function(){w(),o+=n.currentTime-t,r=!0},g.resumePlay=function(){return s()},g.stopPlay=function(){o=0,c=null,w()},g.destroyPlay=function(){this.stopPlay()},g.getAnalyseData=function(){var y=new Uint8Array(h.frequencyBinCount);return h.getByteTimeDomainData(y),y},g.addPlayEnd=function(y){y===void 0&&(y=function(){}),p=y},g.getPlayTime=function(){var y=r?o:n.currentTime-t+o;return e||y},g}();u.default=d},function(_,u,f){Object.defineProperty(u,"__esModule",{value:!0}),u.throwError=function(a){throw new Error(a)}},function(_,u,f){Object.defineProperty(u,"__esModule",{value:!0});var a=f(0),i=function(){function o(t){t===void 0&&(t={}),this.size=0,this.lBuffer=[],this.rBuffer=[],this.tempPCM=[],this.inputSampleBits=16,this.fileSize=0,this.duration=0,this.needRecord=!0;var n,h=new(window.AudioContext||window.webkitAudioContext);this.inputSampleRate=h.sampleRate,this.setNewOption(t),this.littleEdian=(n=new ArrayBuffer(2),new DataView(n).setInt16(0,256,!0),new Int16Array(n)[0]===256),o.initUserMedia()}return o.prototype.setNewOption=function(t){t===void 0&&(t={}),this.config={sampleBits:~[8,16].indexOf(t.sampleBits)?t.sampleBits:16,sampleRate:~[8e3,11025,16e3,22050,24e3,44100,48e3].indexOf(t.sampleRate)?t.sampleRate:this.inputSampleRate,numChannels:~[1,2].indexOf(t.numChannels)?t.numChannels:1},this.outputSampleRate=this.config.sampleRate,this.oututSampleBits=this.config.sampleBits},o.prototype.startRecord=function(){var t=this;return this.context&&this.destroyRecord(),this.initRecorder(),navigator.mediaDevices.getUserMedia({audio:!0}).then(function(n){t.audioInput=t.context.createMediaStreamSource(n),t.stream=n}).then(function(){t.audioInput.connect(t.analyser),t.analyser.connect(t.recorder),t.recorder.connect(t.context.destination)})},o.prototype.pauseRecord=function(){this.needRecord=!1},o.prototype.resumeRecord=function(){this.needRecord=!0},o.prototype.stopRecord=function(){this.audioInput&&this.audioInput.disconnect(),this.source&&this.source.stop(),this.recorder.disconnect(),this.analyser.disconnect(),this.needRecord=!0},o.prototype.destroyRecord=function(){return this.clearRecordStatus(),this.stopStream(),this.closeAudioContext()},o.prototype.getAnalyseData=function(){var t=new Uint8Array(this.analyser.frequencyBinCount);return this.analyser.getByteTimeDomainData(t),t},o.prototype.getData=function(){return this.flat()},o.prototype.clearRecordStatus=function(){this.lBuffer.length=0,this.rBuffer.length=0,this.size=0,this.fileSize=0,this.PCM=null,this.audioInput=null,this.duration=0},o.prototype.flat=function(){var t=null,n=new Float32Array(0);this.config.numChannels===1?t=new Float32Array(this.size):(t=new Float32Array(this.size/2),n=new Float32Array(this.size/2));for(var h=0,c=0;c<this.lBuffer.length;c++)t.set(this.lBuffer[c],h),h+=this.lBuffer[c].length;for(h=0,c=0;c<this.rBuffer.length;c++)n.set(this.rBuffer[c],h),h+=this.rBuffer[c].length;return{left:t,right:n}},o.prototype.initRecorder=function(){var t=this;this.clearRecordStatus(),this.context=new(window.AudioContext||window.webkitAudioContext),this.analyser=this.context.createAnalyser(),this.analyser.fftSize=2048;var n=this.context.createScriptProcessor||this.context.createJavaScriptNode;this.recorder=n.apply(this.context,[4096,this.config.numChannels,this.config.numChannels]),this.recorder.onaudioprocess=function(h){if(t.needRecord){var c,r=h.inputBuffer.getChannelData(0),e=null;t.lBuffer.push(new Float32Array(r)),t.size+=r.length,t.config.numChannels===2&&(e=h.inputBuffer.getChannelData(1),t.rBuffer.push(new Float32Array(e)),t.size+=e.length),t.fileSize=Math.floor(t.size/Math.max(t.inputSampleRate/t.outputSampleRate,1))*(t.oututSampleBits/8),c=100*Math.max.apply(Math,r),t.duration+=4096/t.inputSampleRate,t.onprocess&&t.onprocess(t.duration),t.onprogress&&t.onprogress({duration:t.duration,fileSize:t.fileSize,vol:c})}}},o.prototype.stopStream=function(){this.stream&&this.stream.getTracks&&(this.stream.getTracks().forEach(function(t){return t.stop()}),this.stream=null)},o.prototype.closeAudioContext=function(){return this.context&&this.context.close&&this.context.state!=="closed"?this.context.close():new Promise(function(t){t()})},o.initUserMedia=function(){navigator.mediaDevices===void 0&&(navigator.mediaDevices={}),navigator.mediaDevices.getUserMedia===void 0&&(navigator.mediaDevices.getUserMedia=function(t){var n=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia;return n?new Promise(function(h,c){n.call(navigator,t,h,c)}):Promise.reject(new Error("浏览器不支持 getUserMedia !"))})},o.prototype.transformIntoPCM=function(t,n){var h=new Float32Array(t),c=new Float32Array(n),r=a.compress({left:h,right:c},this.inputSampleRate,this.outputSampleRate);return a.encodePCM(r,this.oututSampleBits,this.littleEdian)},o.getPermission=function(){return this.initUserMedia(),navigator.mediaDevices.getUserMedia({audio:!0}).then(function(t){t&&t.getTracks().forEach(function(n){return n.stop()})})},o}();u.default=i}]).default})})(A);var E=A.exports,V=E;const D=C(V),M=v=>(l.pushScopeId("data-v-c9a9518c"),v=v(),l.popScopeId(),v),O=[M(()=>l.createElementVNode("svg",{width:"20",height:"20",t:"1693473966123",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"4112"},[l.createElementVNode("path",{d:"M827.246871 451.075419c-12.94994-0.588401-23.925922 9.432837-24.51637 22.382776-0.093121 2.062985-0.418532 6.353708-1.106194 12.542664-1.170662 10.54824-2.959402 22.35924-5.490038 35.106566-7.226588 36.413328-18.898419 72.794933-35.917024 106.534362-47.672766 94.508467-126.925784 150.334937-248.217245 150.71663-121.290437-0.381693-200.546525-56.208163-248.217245-150.71663-17.018605-33.739429-28.692482-70.120011-35.919071-106.534362-2.529613-12.747325-4.317329-24.558325-5.487991-35.106566-0.687662-6.188956-1.014096-10.479679-1.108241-12.542664-0.588401-12.94994-11.564383-22.971178-24.514323-22.382776-12.951987 0.588401-22.973224 11.564383-22.382776 24.51637 0.5137 11.339256 2.63092 30.394241 7.446599 54.654784 8.000208 40.316218 20.946055 80.665181 40.051181 118.537743 51.840692 102.776781 138.972145 167.127392 265.456884 175.017082l0 85.599563L291.185872 909.400962c-12.96529 0-23.473621 10.510378-23.473621 23.473621 0 12.96529 10.508331 23.473621 23.473621 23.473621l441.857477 0c12.963243 0 23.473621-10.508331 23.473621-23.473621 0-12.963243-10.510378-23.473621-23.473621-23.473621L534.272259 909.400962l0-85.454254c127.791501-7.209192 215.690434-71.734788 267.86063-175.162392 19.104103-37.872562 32.050973-78.221526 40.051181-118.537743 4.815679-24.260543 6.930853-43.315528 7.446599-54.654784C850.217025 462.639802 840.197834 451.66382 827.246871 451.075419zM510.171352 700.19215c106.568131 0 193.353706-86.506213 193.353706-193.220676L703.525058 260.871449c0-106.59269-86.567611-193.220676-193.353706-193.220676-106.570177 0-193.353706 86.508259-193.353706 193.220676l0 246.100024C316.817646 613.567233 403.385257 700.19215 510.171352 700.19215zM363.764887 260.871449c0-80.693834 65.674769-146.273435 146.407488-146.273435 80.8197 0 146.407488 65.570391 146.407488 146.273435l0 246.100024c0 80.69588-65.674769 146.273435-146.407488 146.273435-80.8197 0-146.407488-65.568345-146.407488-146.273435L363.764887 260.871449z",fill:"#272636","p-id":"4113"})],-1))],U={key:0},I={class:"icon-box"},j=M(()=>l.createElementVNode("path",{d:"M512 0C230.4 0 0 230.4 0 512s230.4 512 512 512 512-230.4 512-512S793.6 0 512 0z m0 981.333333C253.866667 981.333333 42.666667 770.133333 42.666667 512S253.866667 42.666667 512 42.666667s469.333333 211.2 469.333333 469.333333-211.2 469.333333-469.333333 469.333333z",fill:"#515151","p-id":"5084"},null,-1)),k=M(()=>l.createElementVNode("path",{d:"M672 441.6l-170.666667-113.066667c-57.6-38.4-106.666667-12.8-106.666666 57.6v256c0 70.4 46.933333 96 106.666666 57.6l170.666667-113.066666c57.6-42.666667 57.6-106.666667 0-145.066667z",fill:"#515151","p-id":"5085"},null,-1)),z=[M(()=>l.createElementVNode("path",{d:"M511.474 884.11c-205.692 0-373.042-167.083-373.042-372.46 0-205.371 167.35-372.46 373.042-372.46 205.698 0 373.042 167.089 373.042 372.46 0 205.376-167.344 372.46-373.042 372.46m0-819.412c-246.84 0-447.649 200.496-447.649 446.951 0 246.457 200.809 446.951 447.649 446.951 246.842 0 447.649-200.494 447.649-446.951 0-246.455-200.808-446.951-447.649-446.951m127.768 580.701V378.6c0-20.573-16.701-37.247-37.301-37.247-20.606 0-37.307 16.675-37.307 37.247v266.799c0 20.574 16.701 37.249 37.307 37.249 20.601 0 37.301-16.675 37.301-37.249m-179.876 0V378.6c0-20.573-16.701-37.247-37.301-37.247-20.606 0-37.307 16.675-37.307 37.247v266.799c0 20.574 16.701 37.249 37.307 37.249 20.6 0 37.301-16.675 37.301-37.249",fill:"#515151","p-id":"6104"},null,-1))],N=M(()=>l.createElementVNode("br",null,null,-1)),T=[M(()=>l.createElementVNode("svg",{t:"1693479917670",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"7988",width:"20",height:"20"},[l.createElementVNode("path",{d:"M510.825 162c-98.288 0-187.097 40.292-250.839 105.148V182h-60.201v200h200.672v-60H291.104c53.349-61.229 131.967-100 219.721-100 160.7 0 290.974 129.837 290.974 290 0 160.162-130.274 290-290.974 290-147.075 0-268.592-108.777-288.152-250H162c19.926 174.451 168.456 310 348.825 310C704.773 862 862 705.3 862 512S704.773 162 510.825 162z",fill:"#515151","p-id":"7989"})],-1))],L={style:{"margin-top":"300px"}},x=1,b=2,P=3,W=l.defineComponent({__name:"send-record",setup(v){const m=l.reactive(new D),_=l.computed(()=>c(m.duration)),u=l.ref(x);function f(){if(u.value===x){a();return}if(u.value===b){i();return}}function a(){console.log(m),m.start().then(()=>{console.log("开始录音")},s=>{console.log(`异常了,${s.name}:${s.message}`)}),u.value=b}function i(){m==null||m.stop(),console.log(m.file),u.value=P}function o(){m.play()}function t(){m.pausePlay()}function n(){u.value=x}function h(){console.log("wav: ",m.getWAVBlob()),m.downloadWAV()}function c(s){const w=Math.floor(s),d=Math.floor(w/60),g=w%60;return`${d<10?"0"+d:d}:${g<10?"0"+g:g}`}m.onprogress=s=>{console.log("音频总数据：",s)},m.onplay=()=>{console.log("%c回调监听，开始播放音频","color: #2196f3")},m.onpauseplay=()=>{console.log("%c回调监听，暂停播放音频","color: #2196f3")},m.onresumeplay=()=>{console.log("%c回调监听，恢复播放音频","color: #2196f3")},m.onstopplay=()=>{console.log("%c回调监听，停止播放音频","color: #2196f3")},m.onplayend=()=>{m.isplaying=!1,console.log("%c回调监听，音频已经完成播放","color: #2196f3")};const r=l.ref(new Audio);async function e(s){const w=s.target.files[0];if(w.isLoaded){r.value.play();return}await p(w),r.value.play()}function p(s){return new Promise((w,d)=>{var g=URL.createObjectURL(s),y=new Audio(g);r.value=y,y.addEventListener("loadedmetadata",()=>{s.isLoaded=!0,w(y)}),y.addEventListener("error",d)})}return(s,w)=>(l.openBlock(),l.createElementBlock("div",null,[l.createElementVNode("div",{ref:"recorderIconBox",class:"icon-box",onClick:f},O,512),l.createElementVNode("div",null,[u.value===b||u.value===P?(l.openBlock(),l.createElementBlock("span",U,l.toDisplayString(_.value),1)):l.createCommentVNode("",!0)]),l.withDirectives(l.createElementVNode("div",I,[m.isplaying?(l.openBlock(),l.createElementBlock("svg",{key:1,onClick:t,width:"20",height:"20",t:"1693477687958",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"6103"},z)):(l.openBlock(),l.createElementBlock("svg",{key:0,onClick:o,width:"20",height:"20",t:"1693477278174",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"5083"},[j,l.createTextVNode(),k])),l.createElementVNode("button",{onClick:h},"下载wav"),N],512),[[l.vShow,u.value===P]]),l.withDirectives(l.createElementVNode("div",{class:"icon-box",onClick:n},T,512),[[l.vShow,u.value===P]]),l.createElementVNode("div",L,[l.createElementVNode("input",{type:"file",onChange:e},null,32)])]))}}),J="",S=((v,m)=>{const _=v.__vccOpts||v;for(const[u,f]of m)_[u]=f;return _})(W,[["__scopeId","data-v-c9a9518c"]]);S.install=v=>{v.component(S.__name,S)};const F=[S],G={install:v=>{F.forEach(m=>{v.component(m.__name,m)})}};R.SendRecord=S,R.default=G,Object.defineProperties(R,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
